; PlatformIO Project Configuration File
;
; Papilio RetroCade - Wishbone Auto-Builder Template
; 
; This project supports building both ESP32-S3 firmware and Gowin FPGA gateware
; with automatic integration of Papilio Wishbone libraries.
;
; Add Papilio libraries to lib_deps below and they will be automatically:
; - Integrated into the FPGA design with proper Wishbone interconnects
; - Initialized in the ESP32 firmware with correct addresses
; - Configured with non-conflicting address spaces
;
; For more information: https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32, fpga

; ==============================================================================
; ESP32-S3 Firmware Build
; ==============================================================================
[env:esp32]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
build_type = debug
board_build.arduino.memory_type = qio_qspi
board_build.flash_mode = qio
board_build.psram_type = qio
board_upload.flash_size = 4MB
board_upload.maximum_size = 4194304
board_build.partitions = default.csv

build_flags = -I include
              -DARDUINO_USB_CDC_ON_BOOT=1
              -DBOARD_HAS_PSRAM

board_build.filesystem = littlefs

; Serial monitor configuration
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder

; Library dependencies
; Core libraries (required for Wishbone communication):
lib_deps = 
    https://github.com/Papilio-Labs/papilio_spi_slave.git
    https://github.com/Papilio-Labs/papilio_wishbone_bus.git
    https://github.com/Papilio-Labs/papilio_os.git
    ; Add additional Papilio peripheral libraries below:
    ; https://github.com/Papilio-Labs/papilio_wishbone_register.git
    ; https://github.com/Papilio-Labs/papilio_wishbone_rgb_led.git
    ; https://github.com/Papilio-Labs/papilio_wishbone_bram.git

; ==============================================================================
; FPGA Gateware Build
; ==============================================================================
[env:fpga]
platform = https://github.com/Papilio-Labs/platform-gowin.git
board = papilio_retrocade_fpga
framework = hdl

; Dual-purpose pin configuration
; Uncomment to use dedicated pins as regular I/O
board_build.use_sspi_as_gpio = 1
; board_build.use_mspi_as_gpio = 1
; board_build.use_jtag_as_gpio = 1  ; WARNING: Can brick your board! Only enable if you have alternative programming method
; board_build.use_ready_as_gpio = 1
; board_build.use_done_as_gpio = 1

; Papilio Auto-Builder Configuration
board_build.papilio_auto_builder = 1    ; Enable automatic library integration
; board_build.papilio_verbose = 1       ; Uncomment for verbose build output

; FPGA-specific configuration
; board_build.fpga_project = fpga/project.gprj

; Upload protocol for FPGA
upload_protocol = pesptool